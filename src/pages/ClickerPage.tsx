import {FC, useEffect, useState} from "react";
import UserArea from "../components/UserArea/UserArea.tsx";
import Counter from "../components/Counter/Counter.tsx";
import Clicker from "../components/Clicker/Clicker.tsx";
import Energy from "../components/ Energy/Energy.tsx";
import Menu from "../components/Menu/Menu.tsx";
import {gameState} from "../state/GameState.ts";
import {motion} from "framer-motion";
import {getRandomInt} from "../helpers/getRandomInt.ts";
import {observer} from "mobx-react-lite";
import {Chi, Degen, Giga} from "../components/Mems/Mems.tsx";
import {useBackButton} from "@tma.js/sdk-react";
import {useNavigate} from "react-router-dom";
const numberAnimationDurationMs = 6000
const numberAnimationDurationSec = numberAnimationDurationMs / 1000
const ClickerPage:FC = observer(
    () => {
        const [rocket] = useState({
            y: 0,
            x: 0
        })
        const navigate = useNavigate();

        const backButton = useBackButton();

        useEffect(() => {
            backButton.on('click', () => {
                navigate(-1)
            })
            backButton.hide();
        }, []);

        return (
            <div className="clicker-page">

                <div className="clicker-page__header">
                    <UserArea/>
                </div>
                <div className="clicker-page__counter">
                    <Counter/>
                </div>
                <div className="clicker-page__clicker">
                    <Clicker />
                </div>
                <div className="clicker-page__energy">
                    <Energy />
                </div>
                <div className="clicker-page__menu">
                    <Menu />
                </div>
                {gameState.is_rocket ? (
                    <motion.div onTouchStart={() => {
                        gameState.setIsRocket(false);
                        gameState.setX([10, 20, 30, 40, 50, 60, 70, 80, 90, 100][getRandomInt(0, 9)])
                    }} className="rocket"
                                initial={{y: rocket.y + 300, x: getRandomInt(0, window.innerWidth - 100)}}
                                animate={{y: rocket.y - 1000}}
                                transition={{duration: numberAnimationDurationSec}}
                    >
                        <svg width="58" height="58" viewBox="0 0 58 58" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clipPath="url(#clip0_1_3)">
                                <path
                                    d="M24.3593 12.3819L35.8676 12.139L36.9986 28.6684L34.3204 36.6105L32.3209 36.5658L28.9112 32.4886L26.8223 36.4429L23.8231 36.3759L22.114 23.3344L24.3593 12.3819Z"
                                    fill="#D9D9D9"/>
                                <path
                                    d="M25.4879 37.1434C25.4879 37.1434 24.894 41.3719 25.7708 43.4366C26.6476 45.5014 27.7719 46.7671 28.2103 49.242C28.6487 51.7169 29.6669 53.4139 29.6669 53.4139L31.6115 48.4712C31.6115 48.4712 33.3085 48.2308 34.2631 45.367C35.2177 42.5033 36.1723 37.0373 35.6915 37.1505C35.2106 37.2636 32.0711 38.0838 32.0711 38.0838C32.0711 38.0838 30.968 40.3607 29.971 41.2305C28.974 42.1002 28.0972 42.8639 28.0406 41.8739C27.984 40.884 26.5274 37.3202 26.5274 37.3202L25.4667 37.1363L25.4879 37.1434Z"
                                    fill="#EAAF0A"/>
                                <path
                                    d="M36.9431 29.7612L35.3945 36.1888C35.3945 36.1888 37.3532 37.5394 38.1522 39.2294C38.9512 40.9193 40.2806 42.8002 40.2806 42.8002C40.2806 42.8002 41.5888 37.009 40.5069 34.3857C39.425 31.7623 36.9431 29.7612 36.9431 29.7612Z"
                                    fill="#E81515"/>
                                <path
                                    d="M28.7194 31.4088C28.7194 31.4088 31.7882 35.8777 31.7388 37.0868C31.6893 38.296 29.8296 42.079 29.8296 42.079C29.8296 42.079 29.6245 44.2215 29.0447 42.8497C28.4648 41.478 26.7819 35.0999 26.7819 35.0999L28.7265 31.4017L28.7194 31.4088Z"
                                    fill="#E81515"/>
                                <path
                                    d="M21.9241 30.0865L24.7525 37.0161C24.7525 37.0161 21.217 38.3313 20.0361 40.686C18.8553 43.0407 17.9431 44.6882 17.9431 44.6882C17.9431 44.6882 16.2319 41.4497 16.6632 39.9718C17.0946 38.494 17.5754 33.7846 18.2896 33.2684C19.0038 32.7523 21.9241 30.0865 21.9241 30.0865Z"
                                    fill="#E81515"/>
                                <path
                                    d="M25.0637 11.3906C25.0637 11.3906 27.4254 13.0028 29.2356 12.7058C31.0458 12.4088 33.8459 11.136 33.9661 10.5491C34.0863 9.96221 32.9267 5.54986 32.9267 5.54986L31.2226 2.26181L28.3941 5.09024L25.0707 11.3835L25.0637 11.3906Z"
                                    fill="#E81515"/>
                                <path
                                    d="M28.578 18.2424C28.578 18.2424 26.7183 20.9224 28.1466 20.8941C29.575 20.8658 30.6144 22.2447 30.9326 20.5971C31.2508 18.9495 30.0205 17.1111 30.0205 17.1111L28.5709 18.2354L28.578 18.2424Z"
                                    fill="#E81515"/>
                                <path
                                    d="M29.9922 0.720321C27.5244 3.64067 25.4455 6.86508 23.8899 10.3158C23.7697 10.4643 23.6919 10.641 23.6565 10.8319C22.0655 14.5018 21.0827 18.4263 20.8917 22.5204C20.7857 24.7761 20.9271 27.053 21.2948 29.3016C20.3331 29.7966 19.4634 30.5956 18.7846 31.4017C16.9956 33.5159 16.1329 36.1888 16.0622 38.9465C16.0127 41.3295 16.5218 43.7053 17.2784 45.9469C17.5188 46.6681 18.7563 47.0712 19.1169 46.1873C19.6543 44.8721 20.3048 43.5851 21.0261 42.3548C21.5776 41.3931 22.1857 40.4456 22.9141 39.6041C23.3454 39.1021 23.8121 38.6354 24.3283 38.3172C23.3878 39.8233 24.2788 42.3265 24.8162 43.7266C25.4314 45.3458 26.2799 46.859 26.9446 48.4571C27.0294 48.6692 27.1143 48.8814 27.1638 49.1006C27.2133 49.3056 27.2486 49.44 27.2416 49.5602C27.2062 50.0057 27.0931 50.6421 27.2911 51.2077C27.6446 52.2401 28.3871 53.1806 29.179 53.916C29.179 53.916 29.1861 53.8948 29.1861 53.8806C29.4265 54.121 29.7659 54.2624 30.1407 54.1705C30.565 54.0715 30.8337 53.6897 30.8761 53.2796C30.869 53.3008 30.8619 53.322 30.8478 53.3503C30.8619 53.322 30.869 53.2725 30.8832 53.2301C30.8832 53.2018 30.8832 53.1735 30.8832 53.1452C30.8832 53.1169 30.9044 53.1099 30.8973 53.1311C30.9044 53.1099 30.9044 53.0816 30.9114 53.0604C31.0529 52.523 31.2579 51.9926 31.4488 51.4764C31.7953 50.5501 32.1065 49.5885 32.6226 48.7329C32.9833 48.1318 33.457 47.6439 33.9591 47.156C35.048 46.1095 35.8683 45.0064 36.1087 43.4791C36.3915 41.7396 36.2572 39.9223 36.2289 38.1546C36.2996 38.2253 36.3703 38.296 36.4269 38.3667C36.5683 38.5364 36.8794 39.0314 37.0774 39.3708C37.3178 39.795 37.537 40.2264 37.7421 40.6719C38.2583 41.7679 38.6755 42.8639 39.0432 44.066C39.2907 44.8509 40.4715 45.1266 40.8816 44.3064C43.307 39.4486 42.0908 33.8483 39.2412 29.4571C38.9654 29.0258 38.6755 28.6086 38.3502 28.2126C38.2866 28.1348 38.2088 28.0712 38.1239 28.0288C38.3431 25.7165 38.3643 23.3902 38.1664 21.0709C37.8552 17.4505 37.0845 13.8796 35.9319 10.4218C36.0592 10.0683 36.0026 9.65815 35.7127 9.36824C35.6561 9.31167 35.5783 9.27631 35.5076 9.23389C34.8571 7.43783 34.1146 5.69128 33.2661 3.98008C32.7499 2.94063 32.2054 1.90119 31.5691 0.925381C31.2438 0.430406 30.4448 0.182918 29.9922 0.706177L29.9922 0.720321ZM19.5058 40.9901C19.1523 41.584 18.8199 42.1992 18.4946 42.8215C17.9643 40.3961 17.8512 37.8788 18.6856 35.5029C18.8553 35.0079 19.0674 34.5554 19.3644 34.0463C19.4917 33.8341 19.6189 33.622 19.7533 33.4169C19.8169 33.325 19.8806 33.2331 19.9371 33.1482C19.9584 33.127 19.9654 33.12 19.9725 33.1129C20.0149 33.0705 20.0503 33.021 20.0786 32.9785C20.3543 32.6462 20.6372 32.3351 20.9483 32.0381C21.0685 31.9179 21.1958 31.8047 21.3301 31.6987C21.3867 31.6421 21.4645 31.5926 21.5211 31.536C21.5211 31.536 21.5281 31.529 21.5352 31.5219C21.5988 31.4724 21.6625 31.437 21.7261 31.3875C22.108 32.9997 22.6029 34.5695 23.2323 36.1039C23.2888 36.2454 23.3454 36.3868 23.4161 36.5282C21.712 37.4969 20.4604 39.3991 19.5058 41.0042L19.5058 40.9901ZM34.2419 40.0708C34.249 41.1951 34.348 42.3548 34.0864 43.4508C33.7399 44.8862 32.6156 45.5297 31.6822 46.6328C30.6003 47.9268 29.9781 49.539 29.4407 51.137C29.278 50.8754 29.1649 50.6067 29.1366 50.3521C29.1225 50.1824 29.2356 49.843 29.2427 49.5673C29.2497 49.2491 29.2002 48.9309 29.1295 48.6197C28.9457 47.8985 28.5992 47.2126 28.2739 46.5479C27.3759 44.6882 26.3506 42.7578 26.0183 40.7001C25.9688 40.4102 25.9617 40.1203 25.9617 39.8375C25.9688 39.7738 25.9688 39.7031 25.9758 39.6395C25.9758 39.6395 25.9758 39.6395 25.9758 39.6253C25.997 39.5334 26.0253 39.4344 26.0465 39.3425C26.0465 39.3425 26.0465 39.3425 26.0536 39.3354C26.0678 39.3071 26.0678 39.3071 26.0607 39.3001C26.0607 39.3001 26.0678 39.293 26.0748 39.2859C26.0748 39.2859 26.0678 39.293 26.0607 39.3001C26.0253 39.3354 25.9617 39.3708 25.8768 39.4415C26.2516 39.1657 26.4496 38.7415 26.3294 38.296C26.4425 38.3101 26.5415 38.3101 26.6405 38.296C26.6617 38.4728 26.6759 38.6566 26.7042 38.8404C26.9729 40.4102 27.5173 41.9164 28.1891 43.3518C28.479 43.9811 29.3134 43.9528 29.7659 43.571C30.9185 42.574 31.8095 41.188 32.3398 39.7809C32.4883 39.392 32.5873 38.9819 32.6509 38.5647C33.1883 38.395 33.7187 38.2182 34.2561 38.0485C34.2561 38.7273 34.2631 39.3991 34.2631 40.0779L34.2419 40.0708ZM26.0536 39.3071C26.0536 39.3071 26.0395 39.3354 26.0324 39.3566C26.0183 39.3708 26.0112 39.3496 26.0536 39.3071ZM29.3629 41.0325C28.7336 39.3566 28.4012 37.6525 28.479 35.8777C28.4861 35.6726 28.5002 35.4605 28.5214 35.2554C28.5285 35.2059 28.5356 35.114 28.5426 35.0928C28.5497 35.0009 28.5709 34.9089 28.578 34.817C28.6346 34.4635 28.7123 34.117 28.8043 33.7705C28.875 33.5159 28.9598 33.2614 29.0447 33.0068C29.0942 33.0563 29.1437 33.1058 29.179 33.1694C29.2144 33.2048 29.2215 33.2119 29.2356 33.226C29.2427 33.2331 29.2568 33.2472 29.2851 33.3038C29.4477 33.5371 29.6033 33.7776 29.7447 34.0321C30.0629 34.619 30.3104 35.2342 30.4942 35.8706C30.8266 37.009 30.8478 37.8929 30.473 39.0031C30.4589 39.0596 30.3528 39.3354 30.3811 39.2789C30.4023 39.2294 30.2892 39.4839 30.2609 39.5405C30.1548 39.7738 30.0346 39.993 29.9073 40.2052C29.8013 40.3819 29.6952 40.5587 29.575 40.7355C29.5184 40.8203 29.4619 40.9052 29.3912 40.9901C29.3912 40.9901 29.377 41.0042 29.3629 41.0183C29.3629 41.0183 29.3487 41.0325 29.3417 41.0395L29.3629 41.0325ZM29.1366 32.7876C29.1012 32.8654 29.0518 33.0422 29.1366 32.7876ZM38.5623 32.2714C39.5664 34.2513 40.2523 36.507 40.224 38.8122C40.217 39.4981 40.1321 40.1769 39.9907 40.8416C39.7573 40.2971 39.5311 39.7455 39.2765 39.2223C38.732 38.1121 37.8128 36.4434 36.5542 35.8352C36.8724 34.8665 37.1411 33.8766 37.3744 32.8795C37.53 32.2007 37.636 31.5148 37.7562 30.8289C38.0391 31.2956 38.3148 31.7694 38.5623 32.2573V32.2714ZM36.3137 24.8751C36.2713 28.6228 35.6208 32.328 34.4187 35.8777C33.8318 36.0686 33.2449 36.2595 32.658 36.4504C32.4388 34.7746 31.7105 33.1412 30.6781 31.8401C30.2892 31.3522 29.7942 30.8148 29.2073 30.539C28.9528 30.3976 28.6841 30.3834 28.4436 30.4542C28.1962 30.5178 27.984 30.6734 27.8426 30.9138C27.4042 31.5502 27.1284 32.3351 26.9163 33.0705C26.6122 34.124 26.485 35.213 26.4779 36.2949C26.1243 36.2383 25.7708 36.1676 25.4172 36.111C25.396 36.0898 25.396 36.0615 25.3819 36.0332C25.2899 35.8423 25.2051 35.6585 25.1273 35.4675C25.0778 35.3473 25.0354 35.2342 24.9788 35.1211C24.9505 35.0504 24.9152 34.9726 24.8869 34.9019C24.2576 33.2826 23.7767 31.5997 23.4444 29.8955C22.9706 27.5267 22.7939 25.1579 22.8929 22.6406C23.0201 19.5152 23.6565 16.4322 24.703 13.4907C24.802 13.222 24.9152 12.9533 25.0212 12.6775C26.8456 14.12 29.3205 14.6433 31.5691 13.7664C32.5944 13.3634 33.5136 12.7553 34.3551 12.0552C35.6349 16.206 36.3562 20.5335 36.3137 24.8751ZM30.8832 3.71845C31.7105 5.25287 32.5236 6.99943 33.1105 8.47728C33.3085 8.9864 33.4924 9.49552 33.6762 10.0046C32.9338 10.733 32.2054 11.2916 31.1872 11.7583C31.1377 11.7795 31.0882 11.8007 31.0387 11.8219C31.0246 11.836 31.0246 11.836 31.0104 11.836C31.0104 11.836 31.0104 11.836 30.9963 11.8502C30.8902 11.8855 30.7842 11.935 30.671 11.9633C30.4377 12.0411 30.1902 12.1047 29.9498 12.1472C29.8932 12.1613 29.5114 12.2037 29.8084 12.1755C29.7023 12.1825 29.5892 12.1967 29.4831 12.2037C29.278 12.2108 29.073 12.2179 28.8679 12.1967C28.7689 12.1967 28.6699 12.1825 28.5709 12.1684C28.8891 12.2037 28.5568 12.1542 28.479 12.1472C28.2881 12.1118 28.0972 12.0623 27.9133 12.0057C27.8355 11.9845 27.7648 11.9562 27.68 11.928C27.5951 11.8997 27.3335 11.7653 27.6234 11.9138C27.4608 11.836 27.2911 11.7653 27.1213 11.6805C26.8526 11.5391 26.5981 11.3693 26.3435 11.1996C26.3011 11.1572 26.2587 11.1289 26.2092 11.0936C26.1173 11.0158 26.0253 10.938 25.9405 10.8532C25.9051 10.8178 25.8627 10.7754 25.8273 10.74C27.086 8.03888 28.7123 5.49329 30.5579 3.15277C30.6569 3.33662 30.77 3.52046 30.8619 3.71138L30.8832 3.71845Z"
                                    fill="black"/>
                                <path
                                    d="M28.8184 20.194C28.8184 20.194 28.8043 20.2223 28.7972 20.2435C28.7831 20.2577 28.7831 20.2718 28.776 20.293C28.7972 20.2577 28.8113 20.2153 28.8255 20.187C28.8255 20.187 28.8255 20.187 28.8184 20.194Z"
                                    fill="black"/>
                                <path
                                    d="M28.1608 17.4293C27.6305 18.1434 27.1638 18.9212 26.8597 19.7627C26.69 20.2294 26.591 20.7668 26.7324 21.2476C26.9021 21.8557 27.4183 22.3295 28.0406 22.4144C28.0901 22.4214 28.1325 22.4214 28.1749 22.4214C28.2103 22.4285 28.2527 22.4426 28.2881 22.4497C29.0942 22.5487 29.9851 22.6053 30.7559 22.3154C31.1589 22.1669 31.5478 21.9618 31.8236 21.6153C32.1347 21.2335 32.3044 20.8092 32.3681 20.3213C32.4883 19.4092 32.2408 18.4263 31.8236 17.6131C31.4983 16.9767 30.9963 16.4039 30.3175 16.1494C29.2992 15.7676 28.6699 16.7221 28.1537 17.408L28.1608 17.4293ZM29.9215 18.3838C29.9215 18.3838 29.9215 18.3838 29.9286 18.3768C29.9003 18.4051 29.8649 18.4546 29.8508 18.4687C29.872 18.4475 29.9003 18.4192 29.9144 18.3909L29.9215 18.3838ZM30.0134 18.4899C30.0417 18.5465 30.07 18.5889 30.0912 18.6384C30.1124 18.6738 30.1195 18.7091 30.1407 18.7445C30.1407 18.7445 30.1478 18.7515 30.1548 18.7586C30.169 18.7869 30.2043 18.8788 30.2114 18.9142C30.2326 18.992 30.2609 19.0627 30.2821 19.1405C30.3175 19.2889 30.3811 19.4657 30.3882 19.6284C30.3882 19.6284 30.3882 19.6284 30.3882 19.6425C30.3953 19.692 30.3953 19.7486 30.3953 19.791C30.4023 19.8829 30.3953 19.9748 30.3953 20.0738C30.3882 20.0809 30.3882 20.1092 30.3882 20.1233C30.3811 20.1304 30.374 20.1799 30.3599 20.2223C30.3458 20.2365 30.3245 20.286 30.3033 20.3213L30.2963 20.3284C30.2468 20.3496 30.1902 20.3779 30.1407 20.4132C30.1336 20.4203 30.1124 20.4274 30.0983 20.4274C30.0205 20.4486 29.9498 20.4627 29.872 20.484C29.8508 20.491 29.8225 20.491 29.8013 20.4981C29.7235 20.5052 29.6457 20.5122 29.5609 20.5122C29.2851 20.5193 29.0023 20.491 28.7336 20.4627C28.7406 20.4557 28.7406 20.4415 28.7406 20.4274C28.7548 20.3708 28.776 20.3213 28.7972 20.2718C28.7901 20.2789 28.7831 20.3001 28.776 20.3072C28.7972 20.286 28.8043 20.2506 28.8113 20.2294C28.8113 20.2294 28.8113 20.2294 28.8184 20.2223C28.8467 20.1516 28.8467 20.1516 28.8396 20.1728C28.9174 20.0102 28.9952 19.8476 29.08 19.692C29.2568 19.3738 29.4477 19.0697 29.6528 18.7657C29.7447 18.6313 29.8366 18.497 29.9356 18.3697C29.9356 18.3697 29.9356 18.3697 29.9427 18.3626C29.9781 18.398 29.9993 18.4475 30.0276 18.4899H30.0134ZM29.9427 18.3626C29.9427 18.3626 29.9427 18.3626 29.9356 18.3697L29.9427 18.3626Z"
                                    fill="black"/>
                                <path
                                    d="M26.096 39.2647C26.096 39.2647 26.1243 39.2223 26.1314 39.1869C26.1314 39.1869 26.096 39.2506 26.0748 39.2859C26.0607 39.3001 26.0465 39.3142 26.0536 39.3213C26.0536 39.3213 26.0536 39.3213 26.0465 39.3283C26.0607 39.3142 26.0819 39.293 26.1031 39.2435C26.1455 39.2011 26.1314 39.2152 26.1031 39.2435L26.096 39.2647Z"
                                    fill="black"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_1_3">
                                    <rect width="42.04" height="38.57" fill="white"
                                          transform="translate(0.965469 29.7471) rotate(-45)"/>
                                </clipPath>
                            </defs>
                        </svg>
                    </motion.div>
                ) : null}

                {/*<Giga show={gameState.balance % 100 < 1} />*/}
                <Chi show={gameState.chi >= 10000 - 4} />
                <Giga show={gameState.giga >= 1000001- 4} />
                <Degen show={gameState.dgen >= 10000003 - 4} />
            </div>
        )
    }
)

export default ClickerPage;